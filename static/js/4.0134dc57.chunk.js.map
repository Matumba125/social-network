{"version":3,"sources":["Components/Dialogs/Chat/Chat.module.css","Components/Dialogs/Chat/AddMessageForm/AddMessageForm.tsx","Components/Dialogs/Chat/Messages/Message/Message.tsx","Components/Dialogs/Chat/Messages/Messages.tsx","Components/Dialogs/Chat/Chat.tsx","Components/Dialogs/Dialogs.tsx","Components/Dialogs/Dialogs.module.css","Components/Dialogs/Chat/AddMessageForm/AddMessageForm.module.css","Components/Dialogs/Chat/Messages/Message/Message.module.css","Components/Dialogs/Chat/Messages/Messages.module.css"],"names":["module","exports","AddMessageForm","useState","newMessage","setNewMessage","isReady","useSelector","state","chat","dispatch","useDispatch","sendMessageHandler","sendMessage","className","style","addMessage","messageInput","autoSize","minRows","value","onChange","e","target","onKeyPress","key","shiftKey","preventDefault","icon","SendOutlined","color","type","sendBtn","onClick","disabled","Message","props","messageWrapperStyle","last","unique","lastMessageWrapper","message","messageStyle","lastMessage","messageContent","to","userId","src","photo","UserOutlined","avatar","size","svgAppendix","width","height","xmlns","x","y","filterUnits","id","dy","in","result","stdDeviation","values","fill","fillRule","d","filter","first","name","userName","text","Messages","finalSortedMessages","setFinalSortedMessages","messages","autoScroll","setAutoScroll","messagesCounter","setMessagesCounter","elem","document","getElementById","useEffect","sortedMessages","slice","i","length","k","setTimeout","scrollTop","scrollHeight","messagesWrapper","onScroll","element","currentTarget","Math","abs","clientHeight","count","badge","map","m","Chat","startChat","stopChat","chatWrapper","Dialogs","dialogs"],"mappings":"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","file":"static/js/4.0134dc57.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"chatWrapper\":\"Chat_chatWrapper__2X21x\"};","import React, {ChangeEvent, KeyboardEvent, useState} from 'react';\r\nimport TextArea from \"antd/lib/input/TextArea\";\r\nimport style from './AddMessageForm.module.css'\r\nimport {Button} from \"antd\";\r\nimport {SendOutlined} from '@ant-design/icons';\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {sendMessage} from '../../../../redux/chatReducer';\r\nimport {AppStateType} from \"../../../../redux/reduxStore\";\r\n\r\n\r\nexport const AddMessageForm: React.FC = () => {\r\n\r\n    const [newMessage, setNewMessage] = useState<string>('')\r\n\r\n    const isReady = useSelector<AppStateType, boolean>(state => state.chat.isReady)\r\n\r\n   const dispatch = useDispatch()\r\n\r\n    const onMessageTextHandler = (e: ChangeEvent<HTMLTextAreaElement>) => {\r\n        setNewMessage(e.target.value)\r\n    }\r\n\r\n    const onEnterPressHandler = (e: KeyboardEvent<HTMLTextAreaElement>) => {\r\n        if(e.key === 'Enter' && !e.shiftKey){\r\n            e.preventDefault()\r\n            sendMessageHandler()\r\n        }\r\n    }\r\n\r\n    const sendMessageHandler = () => {\r\n        if (!newMessage) {\r\n            return\r\n        }\r\n        dispatch(sendMessage(newMessage))\r\n        setNewMessage('')\r\n    }\r\n\r\n    return (\r\n        <div className={style.addMessage}>\r\n\r\n            <TextArea\r\n                className={style.messageInput}\r\n                autoSize={{minRows: 1,}}\r\n                value={newMessage}\r\n                onChange={onMessageTextHandler}\r\n                onKeyPress={onEnterPressHandler}\r\n            />\r\n\r\n            <Button\r\n                icon={<SendOutlined style={{color: 'rgba(0, 0, 0, 0.85)'}}/>}\r\n                type={'text'}\r\n                className={style.sendBtn}\r\n                onClick={sendMessageHandler}\r\n                disabled={!isReady}\r\n            />\r\n        </div>\r\n    );\r\n};","import React from 'react';\r\nimport style from \"./Message.module.css\";\r\nimport {Avatar} from \"antd\";\r\nimport {UserOutlined} from \"@ant-design/icons\";\r\nimport {ChatMessageType} from '../../../../../api/chat-api';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\n\r\nconst Message: React.FC<ChatMessageType> = (props) => {\r\n\r\n    const messageWrapperStyle = props.last || props.unique ? style.lastMessageWrapper : style.message\r\n    const messageStyle = props.last || props.unique ? style.lastMessage : style.messageContent\r\n\r\n    return (\r\n        <div className={messageWrapperStyle}>\r\n            {(props.last || props.unique) &&\r\n            <NavLink to={'/social-network/profile/' + props.userId}><Avatar\r\n                src={props.photo && props.photo}\r\n                icon={!props.photo && <UserOutlined/>}\r\n                className={style.avatar}\r\n                size={40}/>\r\n                <div className={style.svgAppendix}>\r\n                    <svg width=\"9\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <defs>\r\n                            <filter x=\"-50%\" y=\"-14.7%\" width=\"200%\" height=\"141.2%\" filterUnits=\"objectBoundingBox\"\r\n                                    id=\"a\">\r\n                                <feOffset dy=\"1\" in=\"SourceAlpha\" result=\"shadowOffsetOuter1\"></feOffset>\r\n                                <feGaussianBlur stdDeviation=\"1\" in=\"shadowOffsetOuter1\"\r\n                                                result=\"shadowBlurOuter1\"></feGaussianBlur>\r\n                                <feColorMatrix\r\n                                    values=\"0 0 0 0 0.0621962482 0 0 0 0 0.138574144 0 0 0 0 0.185037364 0 0 0 0.15 0\"\r\n                                    in=\"shadowBlurOuter1\"></feColorMatrix>\r\n                            </filter>\r\n                        </defs>\r\n                        <g fill=\"none\" fillRule=\"evenodd\">\r\n                            <path\r\n                                d=\"M3 17h6V0c-.193 2.84-.876 5.767-2.05 8.782-.904 2.325-2.446 4.485-4.625 6.48A1 1 0 003 17z\"\r\n                                fill=\"rgb(24, 37, 51)\" filter=\"url(#a)\"></path>\r\n                            <path\r\n                                d=\"M3 17h6V0c-.193 2.84-.876 5.767-2.05 8.782-.904 2.325-2.446 4.485-4.625 6.48A1 1 0 003 17z\"\r\n                                fill=\"rgb(24, 37, 51)\" className=\"corner\"></path>\r\n                        </g>\r\n                    </svg>\r\n                </div>\r\n            </NavLink>\r\n            }\r\n            <div className={messageStyle}>\r\n                {(props.first || props.unique) &&\r\n                <NavLink to={'/social-network/profile/' + props.userId}>\r\n                <div className={style.name}>{props.userName}</div>\r\n                </NavLink>}\r\n                <div className={style.text}>{props.message}</div>\r\n            </div>\r\n        </div>\r\n\r\n    );\r\n};\r\n\r\nexport default Message;","import React, {UIEvent, useEffect, useState} from 'react';\r\nimport {ChatMessageType} from '../../../../api/chat-api';\r\n\r\nimport Message from \"./Message/Message\";\r\nimport style from './Messages.module.css'\r\nimport {useSelector} from \"react-redux\";\r\nimport {AppStateType} from \"../../../../redux/reduxStore\";\r\nimport {Badge, Button} from \"antd\";\r\nimport { DownCircleOutlined } from '@ant-design/icons/lib/icons';\r\n\r\n\r\nexport const Messages: React.FC= () => {\r\n\r\n    const [finalSortedMessages, setFinalSortedMessages] = useState<ChatMessageType[]>([])\r\n\r\n    const messages = useSelector<AppStateType, ChatMessageType[]>(state => state.chat.messages)\r\n\r\n    const [autoScroll, setAutoScroll] = useState<boolean>(true)\r\n\r\n    const [messagesCounter, setMessagesCounter] = useState<number>(-2)\r\n\r\n    const elem = document.getElementById('data');\r\n\r\n    useEffect(()=>{\r\n        const sortedMessages = messages.slice()\r\n        if (messages) {\r\n            for (let i = 0; i < sortedMessages.length; i++) {\r\n                if (sortedMessages[i].userId === sortedMessages[i + 1]?.userId && sortedMessages[i].userId !== sortedMessages[i - 1]?.userId) {\r\n                    sortedMessages[i].first = true\r\n                    sortedMessages[i].unique = false\r\n                    let k = i\r\n                    while (sortedMessages[k].userId === sortedMessages[k + 1]?.userId && sortedMessages[k + 1].userId) {\r\n                        k++\r\n                    }\r\n                    sortedMessages[k-1].last = false\r\n                    sortedMessages[k].last = true\r\n                    i = k\r\n                }\r\n                if (sortedMessages[i].userId !== sortedMessages[i + 1]?.userId && !sortedMessages[i].last) {\r\n                    sortedMessages[i].unique = true\r\n                }\r\n            }\r\n        }\r\n        setFinalSortedMessages(sortedMessages)\r\n        setMessagesCounter(messagesCounter +1 )\r\n\r\n        setTimeout(() => {\r\n            if (elem && autoScroll) {\r\n                elem.scrollTop = elem.scrollHeight;\r\n            }\r\n        }, 5)\r\n    }, [messages])\r\n\r\n    const onScrollHandler = (e: UIEvent<HTMLDivElement>) =>{\r\n        const element = e.currentTarget\r\n        if(Math.abs((element.scrollHeight - element.scrollTop) - element.clientHeight) < 150){\r\n            setAutoScroll(true)\r\n        } else {\r\n            setAutoScroll(false)\r\n        }\r\n    }\r\n\r\n    const onButtonClickHandler = () =>{\r\n        if (elem) {\r\n            elem.scrollTop = elem.scrollHeight;\r\n        }\r\n    }\r\n\r\n\r\n    return (\r\n        <div id={'data'} className={style.messagesWrapper} onScroll={onScrollHandler}>\r\n            {!autoScroll && <Button\r\n                type={\"text\"}\r\n                icon={\r\n                    <Badge count={messagesCounter} size={'small'}>\r\n                        <DownCircleOutlined/>\r\n                    </Badge>\r\n                }\r\n                className={style.badge}\r\n                size={'large'}\r\n                onClick={onButtonClickHandler}\r\n            />}\r\n\r\n            {finalSortedMessages.map((m: ChatMessageType, i) =>\r\n                <Message\r\n                    key={i}\r\n                    userName={m.userName}\r\n                    message={m.message}\r\n                    userId={m.userId}\r\n                    photo={m.photo}\r\n                    first={m.first}\r\n                    last={m.last}\r\n                    unique={m.unique}\r\n                />\r\n            )}\r\n\r\n        </div>\r\n    );\r\n};","import React, {useEffect} from 'react';\r\nimport {AddMessageForm} from \"./AddMessageForm/AddMessageForm\";\r\nimport {Messages} from './Messages/Messages';\r\nimport style from './Chat.module.css'\r\nimport {useDispatch} from \"react-redux\";\r\nimport {startChat, stopChat} from \"../../../redux/chatReducer\";\r\n\r\n\r\nexport const Chat: React.FC = props => {\r\n\r\n    const dispatch = useDispatch()\r\n\r\n    useEffect(() => {\r\n        dispatch(startChat())\r\n\r\n        return (() => {\r\n            dispatch(stopChat())\r\n        })\r\n    }, [])\r\n\r\n    return (\r\n        <div className={style.chatWrapper}>\r\n            <Messages/>\r\n            <AddMessageForm/>\r\n        </div>\r\n    );\r\n};\r\n","import React from \"react\";\r\nimport style from \"./Dialogs.module.css\";\r\nimport {Chat} from \"./Chat/Chat\";\r\n\r\nconst Dialogs: React.FC = (props) => {\r\n\r\n    return (\r\n        <div className={style.dialogs}>\r\n            <Chat/>\r\n        </div>\r\n\r\n    )\r\n}\r\n\r\nexport default Dialogs;","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogs\":\"Dialogs_dialogs__2goUN\",\"dialogs_items\":\"Dialogs_dialogs_items__1JDUH\",\"messages\":\"Dialogs_messages__iGu3o\",\"addMessage\":\"Dialogs_addMessage__165qa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"addMessage\":\"AddMessageForm_addMessage__1pBo-\",\"messageInput\":\"AddMessageForm_messageInput__1eIFv\",\"sendBtn\":\"AddMessageForm_sendBtn__3Z0hk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"message\":\"Message_message__3CLID\",\"lastMessageWrapper\":\"Message_lastMessageWrapper__24vfZ\",\"avatar\":\"Message_avatar__mw1E4\",\"messageContent\":\"Message_messageContent__zSm26\",\"lastMessage\":\"Message_lastMessage__2nboT\",\"svgAppendix\":\"Message_svgAppendix__2H4ze\",\"name\":\"Message_name__frqHt\",\"text\":\"Message_text__228oE\",\"time\":\"Message_time__23Oc7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"messagesWrapper\":\"Messages_messagesWrapper__3Ef1v\",\"badge\":\"Messages_badge__3CZMy\"};"],"sourceRoot":""}